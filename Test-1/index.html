<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/prebid.js@latest/dist/not-for-prod/prebid.js" async></script>
    <script type="text/javascript" src="https://c.amazon-adsystem.com/aax2/apstag.js" async></script>
    <script src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>

    <script>
        var div_2_sizes = [
            [970, 250],
        ];

        var PREBID_TIMEOUT = 1000;

        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];

        var adUnits = [
            {
                code: 'div-2',
                mediaTypes: {
                    banner: {
                        sizes: div_2_sizes
                    }
                },
                bids: [{
                    bidder: 'appnexus',
                    params: {
                        placementId: 13144370
                    }
                }]
            }
        ];
    </script>
    <script type="text/javascript">

        apstag = apstag || {};
        apstag.init({
            pubID: '02baacae-0cfc-4942-8fc1-8f85c19e7b49',
            adServer: 'googletag'
        });
        googletag = googletag || { cmd: [] };
        pbjs.que.push(function() {
            pbjs.addAdUnits(adUnits);
            pbjs.requestBids({
                bidsBackHandler: function() {
                    pbjs.setTargetingForGPTAsync();
                    googletag.pubads().refresh();
                },
                timeout: PREBID_TIMEOUT
            });
        });
        var slot;
        googletag.cmd.push(function() {
            slot = googletag.defineSlot(`/21871128741/teststack`, [[300, 250]], 'div-2')
                .addService(googletag.pubads());

            googletag.pubads().enableAsyncRendering();
            googletag.enableServices();

        });

        apstag.fetchBids({
            slots: [{
                slotID: 'div-2',
                slotName: '/21871128741/teststack',
                sizes: [[300, 250]]
            }]
        }, function(bids) {
            googletag.cmd.push(function()
            {

                setTimeout(function() {
                    console.log('refreshed')
                    apstag.setDisplayBids();
                    googletag.pubads().refresh([slot]);
                }, 8 * 1000);
            });
        });

    </script>
</head>

<body>
<h1>Using AppNexus Publisher Ad Server</h1>

<h5>Div-2</h5>
<div id="div-2">

</div>
</body>
<script type="text/javascript">
    googletag.cmd.push(function() {
        googletag.display("div-2");
    });
</script>
</html>
